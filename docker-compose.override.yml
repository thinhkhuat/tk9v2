# Local Development Override
# Automatically merged with docker-compose.yml when running docker-compose up

version: "3.8"

services:
  tk9-backend:
    # Hot reload for backend development
    volumes:
      - ./multi_agents:/app/multi_agents:ro
      - ./web_dashboard:/app/web_dashboard:ro

    environment:
      - DEBUG=true
      - LOG_LEVEL=DEBUG
      - PYTHONPATH=/app:/app/web_dashboard

    # Enable hot reload with uvicorn
    command: ["python", "web_dashboard/main.py"]

  tk9-frontend:
    # For development, use Vite dev server instead of nginx
    build:
      target: builder

    # Run Vite dev server with hot reload
    command: ["npm", "run", "dev", "--", "--host", "0.0.0.0", "--port", "8592"]

    environment:
      - VITE_WS_BASE_URL=ws://localhost:12689
      - VITE_API_BASE_URL=http://localhost:12689

    # Mount source code and environment for hot reload
    volumes:
      - ./web_dashboard/frontend_poc/src:/build/src:ro
      - ./web_dashboard/frontend_poc/public:/build/public:ro
      - ./web_dashboard/frontend_poc/.env.local:/build/.env.local:ro
